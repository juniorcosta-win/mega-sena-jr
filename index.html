<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mega Sena Pro - Acesso Restrito</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        :root { --bg: #1e1e1e; --card: #2d2d2d; --text: #e0e0e0; --accent: #ff8c00; --input-bg: #444; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }

        /* TELA DE LOGIN */
        #loginScreen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #151515; z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-box {
            background: #2d2d2d; padding: 40px; border-radius: 15px; text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7); border: 1px solid #444; width: 90%; max-width: 350px;
        }
        .login-input {
            width: 100%; padding: 12px; margin: 15px 0; border-radius: 5px; border: 1px solid #555;
            background: #333; color: white; font-size: 1.1em; text-align: center; box-sizing: border-box;
        }
        .login-btn {
            width: 100%; padding: 12px; background: var(--accent); color: white; border: none;
            border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 1.1em;
        }
        .login-btn:hover { opacity: 0.9; }

        /* CONTE√öDO DO APP (Escondido inicialmente) */
        #appContent { display: none; width: 100%; padding: 20px; box-sizing: border-box; flex-direction: column; align-items: center; }

        .container { max-width: 800px; width: 100%; background: var(--card); padding: 30px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.5); }
        h1 { text-align: center; color: var(--accent); text-transform: uppercase; margin: 5px 0; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; font-size: 0.9em; }

        .upload-section { border: 2px dashed #555; padding: 15px; text-align: center; border-radius: 10px; margin-bottom: 20px; }
        .custom-file-upload { display: inline-block; padding: 8px 15px; cursor: pointer; background: #444; border-radius: 5px; font-weight: bold; font-size: 0.9em; }
        input[type="file"] { display: none; }

        .manual-section { background: #363636; padding: 20px; border-radius: 10px; margin-bottom: 20px; border: 1px solid #444; }
        .input-group { display: flex; justify-content: center; gap: 5px; margin-bottom: 15px; flex-wrap: wrap; }
        .num-input { width: 45px; height: 45px; font-size: 1.2em; text-align: center; border-radius: 50%; border: 2px solid #555; background: var(--input-bg); color: white; font-weight: bold; }
        .check-btn { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .check-result { margin-top: 15px; padding: 10px; background: #222; border-radius: 5px; display: none; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #363636; padding: 10px; border-radius: 10px; border-left: 4px solid var(--accent); }
        .badge { background: #222; padding: 3px 8px; border-radius: 10px; font-size: 0.8em; font-weight: bold; margin: 2px; display: inline-block; }
        .hot { color: #ff4444; border: 1px solid #ff4444; } .cold { color: #44aaff; border: 1px solid #44aaff; }

        .generator-section { text-align: center; border-top: 1px solid #444; padding-top: 20px; }
        .btn-group { display: flex; justify-content: center; gap: 10px; margin-bottom: 15px; flex-wrap: wrap; }
        .action-btn { padding: 10px 15px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; background: #555; color: white; }
        .result-display { display: flex; justify-content: center; gap: 8px; min-height: 50px; margin-top: 10px; flex-wrap: wrap; }
        .ball { width: 40px; height: 40px; background: radial-gradient(circle at 30% 30%, var(--accent), #a05a00); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; box-shadow: 0 4px 8px rgba(0,0,0,0.5); }

        .auto-analysis { margin-top: 15px; padding: 10px; background: #2a2a2a; border: 1px solid #444; border-radius: 5px; font-size: 0.9em; color: #ccc; display: none; }

        .history-section { margin-top: 20px; border-top: 1px solid #444; padding-top: 15px; }
        .history-list { list-style: none; padding: 0; max-height: 150px; overflow-y: auto; }
        .history-item { background: #333; margin-bottom: 5px; padding: 8px; border-radius: 5px; display: flex; justify-content: space-between; align-items: center; font-size: 0.9em; }
        .save-btn { background: #4caf50; color: white; border: none; padding: 8px 15px; border-radius: 5px; cursor: pointer; margin-top: 10px; display: none; }
    </style>
</head>
<body>

<!-- TELA DE LOGIN -->
<div id="loginScreen">
    <div class="login-box">
        <h2 style="color:var(--accent); margin-top:0;">üîí Acesso Restrito</h2>
        <p style="color:#ccc; font-size:0.9em;">Digite a senha para acessar o sistema Mega Sena Pro.</p>
        <input type="password" id="senhaInput" class="login-input" placeholder="Senha de Acesso">
        <button onclick="verificarSenha()" class="login-btn">ENTRAR</button>
        <p id="msgErro" style="color:#ff4444; display:none; margin-top:10px;">Senha incorreta!</p>
    </div>
</div>

<!-- CONTE√öDO DO SISTEMA -->
<div id="appContent">
    <div class="container">
        <h1>Mega Sena Pro</h1>
        <div class="subtitle">Sistema Profissional VIP</div>

        <div class="upload-section">
            <div id="statusMsg" style="margin-bottom:10px; font-weight:bold;">Tentando carregar dados...</div>
            <label for="fileInput" class="custom-file-upload">üìÇ Carregar Manualmente (se falhar)</label>
            <input type="file" id="fileInput" accept=".csv, .xlsx, .xls">
        </div>

        <div class="manual-section">
            <h3>üîç Conferir Manual</h3>
            <div class="input-group">
                <input type="number" class="num-input" min="1" max="60"><input type="number" class="num-input" min="1" max="60">
                <input type="number" class="num-input" min="1" max="60"><input type="number" class="num-input" min="1" max="60">
                <input type="number" class="num-input" min="1" max="60"><input type="number" class="num-input" min="1" max="60">
            </div>
            <button class="check-btn" onclick="conferirManual()">Verificar</button>
            <div id="manualResult" class="check-result"></div>
            <button id="btnSalvarManual" class="save-btn" onclick="salvarJogoAtual('manual')">üíæ Salvar</button>
        </div>

        <div class="stats-grid">
            <div class="stat-card"><h3>üî• Quentes</h3><div id="hotNumbers">--</div></div>
            <div class="stat-card" style="border-left-color: #44aaff;"><h3>‚ùÑÔ∏è Frios</h3><div id="coldNumbers">--</div></div>
        </div>

        <div class="generator-section">
            <div class="btn-group">
                <button class="action-btn" onclick="gerarJogo('quente')">Quente</button>
                <button class="action-btn" onclick="gerarJogo('equilibrado')">Equilibrado</button>
                <button class="action-btn" onclick="gerarJogo('surpresa')">Surpresa</button>
            </div>
            <div id="resultado" class="result-display"></div>
            <div id="analiseAuto" class="auto-analysis"></div>
            <button id="btnSalvarGerado" class="save-btn" onclick="salvarJogoAtual('gerado')">üíæ Salvar</button>
        </div>

        <div class="history-section">
            <h3>üìú Jogos Salvos</h3>
            <ul id="listaHistorico" class="history-list"></ul>
            <button onclick="limparHistorico()" style="background:none; color:#888; border:none; cursor:pointer; font-size:0.8em; margin-top:5px;">Limpar Tudo</button>
        </div>
    </div>
</div>

<script>
    // --- L√ìGICA DE SENHA ---
    function verificarSenha() {
        const senhaDigitada = document.getElementById('senhaInput').value;
        const senhaCorreta = "mega2025"; // <--- MUDE SUA SENHA AQUI

        if (senhaDigitada === senhaCorreta) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('appContent').style.display = 'flex';
            // Inicia o sistema
            carregarHistoricoSalvo();
            carregarCSVAutomatico();
        } else {
            document.getElementById('msgErro').style.display = 'block';
        }
    }

    // --- SISTEMA MEGA SENA ---
    let historicoJogos = [];
    let frequencia = {};
    let jogoAtualManual = [], jogoAtualGerado = [];

    function carregarCSVAutomatico() {
        fetch('megasena_limpa.csv')
            .then(response => {
                if (!response.ok) throw new Error("Arquivo n√£o encontrado");
                return response.text();
            })
            .then(text => {
                processarCSVTexto(text);
                document.getElementById('statusMsg').innerHTML = `‚úÖ <b>Conectado!</b> Dados carregados automaticamente.`;
                document.getElementById('statusMsg').style.color = '#4caf50';
            })
            .catch(err => {
                document.getElementById('statusMsg').innerHTML = `‚ö†Ô∏è Modo Offline. Carregue o arquivo manualmente.`;
                document.getElementById('statusMsg').style.color = '#ffaa00';
            });
    }

    document.getElementById('fileInput').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            const data = new Uint8Array(e.target.result);
            try {
                const workbook = XLSX.read(data, {type: 'array'});
                const json = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], {header: 1});
                historicoJogos = scannerInteligente(json);
                if(historicoJogos.length > 0) sucessoCarregamento(historicoJogos.length);
            } catch (error) {
                const tr = new FileReader();
                tr.onload = evt => processarCSVTexto(evt.target.result);
                tr.readAsText(file);
            }
        };
        reader.readAsArrayBuffer(file);
    });

    function processarCSVTexto(text) {
        const lines = text.split('\n');
        historicoJogos = [];
        lines.forEach(line => {
            let nums = line.split(/[;,]/).map(n => parseInt(n.trim())).filter(n => !isNaN(n) && n >= 1 && n <= 60);
            if (nums.length >= 6) historicoJogos.push(nums.slice(0, 6));
        });
        if (historicoJogos.length > 0) sucessoCarregamento(historicoJogos.length);
    }

    function sucessoCarregamento(qtd) {
        processarEstatisticas();
        document.getElementById('statusMsg').innerHTML = `‚úÖ <b>${qtd}</b> concursos carregados.`;
        document.getElementById('statusMsg').style.color = '#4caf50';
    }

    function scannerInteligente(linhas) {
        let contagem = {};
        linhas.forEach(l => l.forEach((c, i) => { let v=parseInt(c); if(v>=1&&v<=60) contagem[i]=(contagem[i]||0)+1; }));
        let cols = Object.keys(contagem).map(Number).sort((a,b)=>contagem[b]-contagem[a]).slice(0,6).sort((a,b)=>a-b);
        if(cols.length<6) return [];
        let jogos=[];
        linhas.forEach(l => { let j=[]; cols.forEach(c=>{ let v=parseInt(l[c]); if(v>=1&&v<=60) j.push(v); }); if(j.length===6) jogos.push(j); });
        return jogos;
    }

    function processarEstatisticas() {
        frequencia = {}; for(let i=1;i<=60;i++) frequencia[i]=0;
        historicoJogos.forEach(j=>j.forEach(n=>frequencia[n]++));
        let ord = Object.keys(frequencia).map(k=>({n:parseInt(k),q:frequencia[k]})).sort((a,b)=>b.q-a.q);
        document.getElementById('hotNumbers').innerHTML = ord.slice(0,5).map(i=>`<span class="badge hot">${i.n}</span>`).join(' ');
        document.getElementById('coldNumbers').innerHTML = ord.slice(-5).reverse().map(i=>`<span class="badge cold">${i.n}</span>`).join(' ');
    }

    function conferirManual() {
        if(historicoJogos.length===0) return alert("Sem dados!");
        let aposta = Array.from(document.querySelectorAll('.num-input')).map(i=>parseInt(i.value)).filter(n=>!isNaN(n)&&n>=1&&n<=60);
        aposta = [...new Set(aposta)].sort((a,b)=>a-b);
        if(aposta.length!==6) return alert("Digite 6 n√∫meros v√°lidos.");
        jogoAtualManual = aposta;
        let res = analisarJogo(aposta);
        let div = document.getElementById('manualResult'); div.style.display='block';
        div.innerHTML = `<div>Seus: <b style="color:var(--accent)">${aposta.join('-')}</b></div><hr style="border-color:#444">` +
            (res.sena>0 ? `<div style="color:#4caf50">üèÜ SENA: ${res.sena}x</div>` : `<div>‚ùå Sena: 0x</div>`) +
            `<div>üåü Quina: ${res.quina}x | üçÄ Quadra: ${res.quadra}x</div>`;
        document.getElementById('btnSalvarManual').style.display='inline-block';
    }

    function gerarJogo(tipo) {
        if(historicoJogos.length===0) return alert("Sem dados!");
        let nums = Object.keys(frequencia).map(Number), esc = [];
        if(tipo==='surpresa') esc = nums.sort(()=>0.5-Math.random()).slice(0,6);
        else {
            let pool=[]; nums.forEach(n=>{ let p=tipo==='quente'?frequencia[n]:(1000-frequencia[n]); for(let i=0;i<Math.ceil(p/10);i++) pool.push(n); });
            while(esc.length<6) { let r=pool[Math.floor(Math.random()*pool.length)]; if(!esc.includes(r)) esc.push(r); }
        }
        jogoAtualGerado = esc.sort((a,b)=>a-b);
        document.getElementById('resultado').innerHTML = jogoAtualGerado.map(n=>`<div class="ball">${n<10?'0'+n:n}</div>`).join('');
        let res = analisarJogo(jogoAtualGerado);
        let div = document.getElementById('analiseAuto'); div.style.display='block';
        div.innerHTML = (res.sena>0 ? `<span style="color:#ff4444">‚ö†Ô∏è J√Å SAIU ${res.sena}x!</span>` : `<span style="color:#4caf50">‚úÖ In√©dito (Nunca deu Sena)</span>`) + `<br><small>Quinas: ${res.quina} | Quadras: ${res.quadra}</small>`;
        document.getElementById('btnSalvarGerado').style.display='inline-block';
    }

    function analisarJogo(j) {
        let s=0, q=0, qa=0;
        historicoJogos.forEach(h => { let ac=h.filter(n=>j.includes(n)).length; if(ac===6)s++; if(ac===5)q++; if(ac===4)qa++; });
        return {sena:s, quina:q, quadra:qa};
    }

    function salvarJogoAtual(o) {
        let j = o==='manual'?jogoAtualManual:jogoAtualGerado;
        if(!j || j.length!==6) return;
        let h = JSON.parse(localStorage.getItem('meusJogosMega'))||[];
        if(h.some(x=>JSON.stringify(x.n)===JSON.stringify(j))) return alert("J√° salvo!");
        h.push({d:new Date().toLocaleDateString(), n:j, t:o==='manual'?'Manual':'Gerado'});
        localStorage.setItem('meusJogosMega', JSON.stringify(h));
        carregarHistoricoSalvo();
    }

    function carregarHistoricoSalvo() {
        let h = JSON.parse(localStorage.getItem('meusJogosMega'))||[], l = document.getElementById('listaHistorico'); l.innerHTML='';
        if(h.length===0) l.innerHTML='<li style="color:#666;text-align:center">Vazio</li>';
        h.reverse().forEach((x,i) => {
            let li=document.createElement('li'); li.className='history-item';
            li.innerHTML=`<div><small style="color:#888">${x.d} (${x.t})</small><br><b style="color:var(--accent)">${x.n.map(n=>n<10?'0'+n:n).join('-')}</b></div><button onclick="rmItem(${h.length-1-i})" style="color:#ff4444;background:none;border:none;cursor:pointer">X</button>`;
            l.appendChild(li);
        });
    }
    function rmItem(i) { let h=JSON.parse(localStorage.getItem('meusJogosMega'))||[]; h.splice(i,1); localStorage.setItem('meusJogosMega',JSON.stringify(h)); carregarHistoricoSalvo(); }
    function limparHistorico() { if(confirm("Apagar tudo?")) { localStorage.removeItem('meusJogosMega'); carregarHistoricoSalvo(); } }
</script>
</body>
</html>
